<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zahid Asghar">
<meta name="dcterms.date" content="2024-12-18">

<title>Modernizing National Statistical Systems (NSS)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="modernising_statistics_slides_files/libs/clipboard/clipboard.min.js"></script>
<script src="modernising_statistics_slides_files/libs/quarto-html/quarto.js"></script>
<script src="modernising_statistics_slides_files/libs/quarto-html/popper.min.js"></script>
<script src="modernising_statistics_slides_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="modernising_statistics_slides_files/libs/quarto-html/anchor.min.js"></script>
<link href="modernising_statistics_slides_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="modernising_statistics_slides_files/libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="modernising_statistics_slides_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="modernising_statistics_slides_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="modernising_statistics_slides_files/libs/bootstrap/bootstrap-933a14f46f0e4d1503cecf416b5e09b4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modernizing National Statistical Systems (NSS)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zahid Asghar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><strong>Context and Importance:</strong><br>
Modernizing National Statistical Systems is critical for ensuring timely, accurate, and reliable data to inform evidence-based policymaking. As data ecosystems expand—encompassing big data, administrative records, and new digital sources —NSS must evolve technologically, organizationally, and culturally to remain credible and relevant.</p>
<p><strong>Key Objectives:</strong><br>
- Enhance interoperability, data quality, and standardization.</p>
<ul>
<li><p>Adopt advanced technologies (AI, ML, and cloud-based platforms) to improve data production and analysis.</p></li>
<li><p>Foster trust, transparency, and user-centric data dissemination.</p></li>
</ul>
<hr>
</section>
<section id="drivers-of-change-in-national-statistical-systems" class="level2">
<h2 class="anchored" data-anchor-id="drivers-of-change-in-national-statistical-systems">Drivers of Change in National Statistical Systems</h2>
<ul>
<li><p><strong>Digital Transformation:</strong> Rapid technological advancements require more flexible, automated, and scalable data processing systems.</p></li>
<li><p><strong>Growing Data Ecosystem:</strong> Emergence of big data, administrative data, and geospatial data is challenging traditional statistical methods.</p></li>
<li><p><strong>User Expectations:</strong> Policymakers, researchers, private sector entities, and the public demand real-time insights, interactive dashboards, and easy access to granular data.</p></li>
<li><p><strong>Global and National Priorities:</strong> International frameworks (e.g., SDGs), climate change indicators, and evolving social-economic landscapes call for more integrated and responsive NSS.</p></li>
</ul>
<hr>
</section>
<section id="core-challenges-and-gaps" class="level2">
<h2 class="anchored" data-anchor-id="core-challenges-and-gaps">Core Challenges and Gaps</h2>
<section id="data-integration-and-interoperability" class="level3">
<h3 class="anchored" data-anchor-id="data-integration-and-interoperability">Data Integration and Interoperability</h3>
<ul>
<li><strong>Current State:</strong> Limited or no standardized data sharing templates; lack of “tidy data” practices.</li>
<li><strong>Gaps:</strong> No common metadata standards; weak data exchange protocols; fragmented data storage systems.</li>
</ul>
</section>
<section id="technological-constraints" class="level3">
<h3 class="anchored" data-anchor-id="technological-constraints">Technological Constraints</h3>
<ul>
<li><strong>Current State:</strong> Outdated survey tools, reliance on legacy software (e.g., FoxPro), and low adoption of digital solutions.</li>
<li><strong>Gaps:</strong> Manual data collection prone to errors; low productivity; difficulty integrating big data and alternative data sources.</li>
</ul>
</section>
<section id="organizational-and-administrative-barriers" class="level3">
<h3 class="anchored" data-anchor-id="organizational-and-administrative-barriers">Organizational and Administrative Barriers</h3>
<ul>
<li><strong>Current State:</strong> Siloed bureaus; administrative data not integrated into official statistics.</li>
<li><strong>Gaps:</strong> Lack of a cohesive governance framework; weak inter-ministerial coordination; no streamlined data stewardship model.</li>
</ul>
</section>
<section id="human-resources-and-skill-sets" class="level3">
<h3 class="anchored" data-anchor-id="human-resources-and-skill-sets">Human Resources and Skill Sets</h3>
<ul>
<li><strong>Current State:</strong> Inability to attract and retain talent with modern data skills; insufficient training for staff on new methodologies.</li>
<li><strong>Gaps:</strong> Workforce lacks data science, AI, and advanced analytical capabilities; rigid HR structures discourage innovation.</li>
</ul>
<hr>
</section>
</section>
<section id="risks-and-threats" class="level2">
<h2 class="anchored" data-anchor-id="risks-and-threats">Risks and Threats</h2>
<ul>
<li><strong>Trust and Credibility:</strong> Proliferation of misinformation, “alternative facts,” and fake news undermine public trust in official statistics.</li>
<li><strong>Competition from Private Providers:</strong> Data-savvy private sector entities often offer more user-friendly, branded data products, challenging the NSS monopoly.</li>
<li><strong>Declining Response Rates:</strong> Survey fatigue, privacy concerns, and mistrust lead to lower participation and less representative data.</li>
</ul>
<hr>
</section>
<section id="modern-data-ecosystem-opportunities" class="level2">
<h2 class="anchored" data-anchor-id="modern-data-ecosystem-opportunities">Modern Data Ecosystem Opportunities</h2>
<ul>
<li><strong>Big Data and AI:</strong>
<ul>
<li>Deploy Generative AI (Gen AI) and Large Language Models (LLMs) for data cleaning, metadata generation, and automated reporting.<br>
</li>
<li>Use AI-driven chatbots and digital portals to enhance user engagement and feedback loops.</li>
</ul></li>
<li><strong>Cloud Infrastructure and Automation:</strong>
<ul>
<li>Centralize data storage and streamline data pipelines for reproducibility and transparency.<br>
</li>
<li>Real-time data sharing, integration of API-driven data flows, and automated quality checks.</li>
</ul></li>
<li><strong>Climate and Sustainability Data:</strong>
<ul>
<li>Implement structured approaches to integrate climate-related indicators, ensuring inclusive frameworks for environmental statistics.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="strengthening-governance-and-frameworks" class="level2">
<h2 class="anchored" data-anchor-id="strengthening-governance-and-frameworks">Strengthening Governance and Frameworks</h2>
<ul>
<li><strong>Legal and Ethical Frameworks:</strong>
<ul>
<li>Establish robust data governance policies that emphasize data privacy, security, and public trust.<br>
</li>
<li>Align national statistical regulations with international standards and ethical guidelines.</li>
</ul></li>
<li><strong>National Data Policies:</strong>
<ul>
<li>Develop comprehensive national policies addressing data stewardship, interoperability standards, and open data principles.<br>
</li>
<li>Engage legal experts, policymakers, and international bodies (World Bank, UN) to ensure compliance and global alignment.</li>
</ul></li>
<li><strong>Institutional Reform:</strong>
<ul>
<li>Foster integrated governance structures to break down bureaucratic silos.<br>
</li>
<li>Encourage interdepartmental task forces and expert groups to guide modernization efforts and ensure accountability.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="human-capital-development" class="level2">
<h2 class="anchored" data-anchor-id="human-capital-development">Human Capital Development</h2>
<ul>
<li><strong>Capacity Building and Training:</strong>
<ul>
<li>Provide tailored training programs on modern statistical methods, data science techniques, and AI-driven tools.<br>
</li>
<li>Implement mentorship programs, scholarships, and partnerships with academia to attract young talent.</li>
</ul></li>
<li><strong>Flexible HR Policies:</strong>
<ul>
<li>Introduce performance-based incentives, opportunities for continuous learning, and flexible career pathways to retain high-quality staff.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="strategies-for-a-modernized-nss" class="level2">
<h2 class="anchored" data-anchor-id="strategies-for-a-modernized-nss">Strategies for a Modernized NSS</h2>
<ol type="1">
<li><strong>Standardization and Interoperability:</strong>
<ul>
<li>Adopt global data formats (e.g., SDMX), metadata standards, and harmonized classifications.<br>
</li>
<li>Implement a unified data-sharing platform for all bureaus and ministries.</li>
</ul></li>
<li><strong>Technology Upgrades and Innovations:</strong>
<ul>
<li>Phase out outdated technologies; migrate to modern, scalable databases and statistical packages.<br>
</li>
<li>Integrate machine learning algorithms for predictive analytics and automated data validation.</li>
</ul></li>
<li><strong>User-Centric Data Services:</strong>
<ul>
<li>Develop interactive dashboards, APIs, and data visualization tools for stakeholders.<br>
</li>
<li>Launch feedback channels and community engagement strategies to ensure data products meet user needs.</li>
</ul></li>
<li><strong>Holistic Integration of Administrative Data:</strong>
<ul>
<li>Convert administrative data into machine-readable formats.<br>
</li>
<li>Link different databases across ministries and agencies to create a single source of truth.</li>
</ul></li>
<li><strong>Monitoring and Evaluation Mechanisms:</strong>
<ul>
<li>Establish Key Performance Indicators (KPIs) and regular performance audits to track progress.<br>
</li>
<li>Continuously refine methodologies and technologies based on stakeholder feedback and outcome assessments.</li>
</ul></li>
</ol>
<hr>
</section>
<section id="partnering-for-success" class="level2">
<h2 class="anchored" data-anchor-id="partnering-for-success">Partnering for Success</h2>
<ul>
<li><strong>International Collaboration:</strong>
<ul>
<li>Engage with global organizations (UN, World Bank) for technical assistance, funding, and knowledge exchange.<br>
</li>
<li>Benchmark against international best practices and frameworks.</li>
</ul></li>
<li><strong>Public-Private-Academic Partnerships:</strong>
<ul>
<li>Collaborate with private tech firms and academia to co-develop innovative tools and methodologies.<br>
</li>
<li>Leverage research institutions for advanced analytics and to stay ahead of emerging trends.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="roadmap-for-implementation" class="level2">
<h2 class="anchored" data-anchor-id="roadmap-for-implementation">Roadmap for Implementation</h2>
<p><strong>Short-Term (6-12 months):</strong><br>
- Identify and adopt common data standards.<br>
- Pilot automated data collection tools in selected surveys.<br>
- Launch staff training programs on data science fundamentals.</p>
<p><strong>Medium-Term (1-3 years):</strong><br>
- Fully integrate administrative data sources; establish central data repositories.<br>
- Implement AI-driven quality checks and metadata management systems.<br>
- Formulate and enforce a robust national data governance policy.</p>
<p><strong>Long-Term (3-5 years):</strong><br>
- Achieve seamless interoperability across ministries and bureaus.<br>
- Institutionalize continuous capacity-building and knowledge-sharing frameworks.<br>
- Position the NSS as a trusted, agile, and innovative entity that drives evidence-based policymaking.</p>
<hr>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Modernizing National Statistical Systems is not a one-off effort—it requires sustained commitment, strategic planning, and collaborative action. By embracing technological innovation, strengthening governance frameworks, building human capital, and forging strong partnerships, NSS can enhance data quality, trust, and relevance. Ultimately, a modern NSS will empower policymakers, businesses, and citizens with the reliable data they need to make informed decisions.</p>
<p><strong>Next Steps:</strong><br>
- Garner political support and secure financial investments for modernization.<br>
- Start small with pilot projects and scale successful solutions.<br>
- Continuously evaluate, refine, and communicate progress to maintain momentum and stakeholder confidence.</p>
<hr>
<p><strong>Thank You</strong><br>
<strong>Contact:</strong> Zahid Asghar<br>
For further discussions and collaboration.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>