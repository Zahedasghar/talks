<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zahid Asghar">
<meta name="dcterms.date" content="2024-10-24">

<title>Treating AI as Your Economic Consultant — What That Looks Like in 2025 and How to Get It Right</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="ai_economic_consultant_files/libs/clipboard/clipboard.min.js"></script>
<script src="ai_economic_consultant_files/libs/quarto-html/quarto.js"></script>
<script src="ai_economic_consultant_files/libs/quarto-html/popper.min.js"></script>
<script src="ai_economic_consultant_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ai_economic_consultant_files/libs/quarto-html/anchor.min.js"></script>
<link href="ai_economic_consultant_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ai_economic_consultant_files/libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ai_economic_consultant_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ai_economic_consultant_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ai_economic_consultant_files/libs/bootstrap/bootstrap-d33514348c9c943ed6f9797c7b8e5fcd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">


<link rel="stylesheet" href="logo1.css">
</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="yellow">Treating AI as Your Economic Consultant — What That Looks Like in 2025 and How to Get It Right</span></h1>
<p class="subtitle lead">GCU, Lahore</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zahid Asghar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 24, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="why-this-is-suddenly-feasible" class="level2">
<h2 class="anchored" data-anchor-id="why-this-is-suddenly-feasible">1. Why this is suddenly feasible</h2>
<ul>
<li><strong>Capability jump.</strong> Large language-model (LLM) agents can now ingest millions of rows of macro data, run econometrics, draft policy memos, and explain the results in plain language—all inside the same workflow. McKinsey estimates generative AI could add <strong>$2.6 – $4.4 trillion</strong> of annual value; economic analysis and “research &amp; development” are among the highest-impact use-cases.</li>
<li><strong>Industry adoption.</strong> Gartner expects <strong>75% of consulting firms to embed AI into core workflows this year</strong>; internal “AI co-partners” have already cut project turnaround times by 30-50%.</li>
<li><strong>Workforce readiness gap.</strong> Employees are keen, but leadership direction lags—McKinsey’s “Super-agency” survey found only <strong>1% of firms feel AI-mature.</strong></li>
</ul>
</section>
<section id="what-an-ai-economic-consultant-can-actually-do-today" class="level2">
<h2 class="anchored" data-anchor-id="what-an-ai-economic-consultant-can-actually-do-today">2. What an AI economic consultant can actually do today</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 24%">
<col style="width: 21%">
<col style="width: 27%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Domain</th>
<th>Typical Outputs</th>
<th>AI Strengths</th>
<th>Human Safeguards</th>
<th>Key Tech</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Macro forecasting</em></td>
<td>GDP, inflation, debt-sustainability baselines</td>
<td>Non-linear pattern capture, rapid scenario sweeps</td>
<td>Validate model selection, stress-test out-of-sample</td>
<td>Time-series foundation models, LLM-powered simulators</td>
</tr>
<tr class="even">
<td><em>Policy design</em></td>
<td>Dynamic scoring of tax, subsidy, or tariff options</td>
<td>Instantly recompute fiscal &amp; welfare impacts under multiple elasticities</td>
<td>Set guard-rails, check assumptions</td>
<td>Agentic “policy sandbox” with structural models</td>
</tr>
<tr class="odd">
<td><em>Sector &amp; firm analysis</em></td>
<td>Equity notes, industry outlooks</td>
<td>Synthesise filings + news in minutes (UBS now delivers analyst videos via AI avatars)</td>
<td>Sign-off for compliance &amp; nuance</td>
<td>Retrieval-augmented LLMs, text-to-avatar pipelines</td>
</tr>
<tr class="even">
<td><em>Narrative &amp; comms</em></td>
<td>Budget briefs, op-eds, stakeholder decks</td>
<td>Consistent style, multilingual output</td>
<td>Tone, political judgement</td>
<td>Gen-AI copy &amp; slide generators</td>
</tr>
<tr class="odd">
<td><em>Interactive advisory</em></td>
<td>Chat-style Q&amp;A on live dashboards</td>
<td>24/7 availability, memory of prior queries</td>
<td>Escalate contentious advice</td>
<td>RAG chatbots tied to official data lakes</td>
</tr>
</tbody>
</table>
</section>
<section id="architecture-blueprint-high-level" class="level2">
<h2 class="anchored" data-anchor-id="architecture-blueprint-high-level">3. Architecture blueprint (high-level)</h2>
<ol type="1">
<li><strong>Data layer</strong> – secure lake + governed economic datasets, streaming indicators, and enterprise knowledge base.</li>
<li><strong>Model layer</strong> – combination of:
<ul>
<li>foundation LLM (open-source or vendor),</li>
<li>specialised forecasting/TS models,</li>
<li>tool-calling agents (Python, R, Stata).</li>
</ul></li>
<li><strong>Orchestration &amp; safety</strong> – retrieval pipelines, guard-rails (budget caps, forbidden actions), audit logs.</li>
<li><strong>Human-in-the-loop</strong> – review interface with uncertainty flags and “ask for evidence” buttons.</li>
</ol>
</section>
<section id="implementation-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="implementation-roadmap">4. Implementation roadmap</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 35%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Phase</th>
<th>What to do</th>
<th>Typical time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>1 – Frame the questions</strong></td>
<td>Pick 2–3 high-value use-cases (e.g., quarterly macro forecast, telecom tariff advice). Define success metrics.</td>
<td>2 weeks</td>
</tr>
<tr class="even">
<td><strong>2 – Data &amp; governance audit</strong></td>
<td>Map data sources, fix gaps, set confidentiality tiers.</td>
<td>4 weeks</td>
</tr>
<tr class="odd">
<td><strong>3 – Pilot build</strong></td>
<td>Fine-tune or prompt-engineer LLM; wire to datasets; run shadow tests vs.&nbsp;human baseline.</td>
<td>6 weeks</td>
</tr>
<tr class="even">
<td><strong>4 – Validation</strong></td>
<td>Back-test accuracy, bias checks, hallucination rate; involve domain experts.</td>
<td>3 weeks</td>
</tr>
<tr class="odd">
<td><strong>5 – Roll-out</strong></td>
<td>Deploy to economists as copilot; add dashboard &amp; version control.</td>
<td>4 weeks</td>
</tr>
<tr class="even">
<td><strong>6 – Scale &amp; monitor</strong></td>
<td>Embed into planning cycles; continuous learning loop; annual model “health check”.</td>
<td>ongoing</td>
</tr>
</tbody>
</table>
</section>
<section id="benefits-you-can-expect" class="level2">
<h2 class="anchored" data-anchor-id="benefits-you-can-expect">5. Benefits you can expect</h2>
<ul>
<li><strong>Speed:</strong> draft a comparative budget note in seconds instead of days.</li>
<li><strong>Breadth:</strong> pull hundreds of country precedents automatically.</li>
<li><strong>Consistency:</strong> common methodology across teams and time.</li>
<li><strong>Cost:</strong> once the platform is live, marginal cost of a new analysis trends toward zero.</li>
</ul>
<p>McKinsey finds that generative AI lifts individual-knowledge-worker productivity by <strong>30-60%</strong> in research-heavy tasks.</p>
</section>
<section id="risks-how-to-manage-them" class="level2">
<h2 class="anchored" data-anchor-id="risks-how-to-manage-them">6. Risks &amp; how to manage them</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th>Risk</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Memorisation &amp; data leakage</strong> – models may regurgitate proprietary forecasts.</td>
<td>Differential privacy, strict context windows, red-teaming.</td>
</tr>
<tr class="even">
<td><strong>Hallucination &amp; over-confidence</strong></td>
<td>Force citation retrieval; penalise no-source answers.</td>
</tr>
<tr class="odd">
<td><strong>Forecast reliability</strong> – LLMs still trail top human super-forecasters on many real-world prediction tasks.</td>
<td>Blend AI probability outputs with human judgement; use ensemble methods.</td>
</tr>
<tr class="even">
<td><strong>Regulatory &amp; ethical gaps</strong></td>
<td>Align with emerging OECD generative-AI principles (transparency, accountability).</td>
</tr>
</tbody>
</table>
</section>
<section id="skill-shifts-for-human-economists" class="level2">
<h2 class="anchored" data-anchor-id="skill-shifts-for-human-economists">7. Skill shifts for human economists</h2>
<ul>
<li>Move <strong>up the value chain</strong>: from data wrangling to framing questions and stress-testing AI results.</li>
<li><strong>Prompt-crafting &amp; agent-design</strong> become essential technical skills.</li>
<li><strong>Story-telling with uncertainty</strong>—explaining probabilistic AI outputs to ministers, investors, or media.</li>
</ul>
</section>
<section id="fast-start-ideas-you-could-pilot-next-quarter" class="level2">
<h2 class="anchored" data-anchor-id="fast-start-ideas-you-could-pilot-next-quarter">8. Fast-start ideas you could pilot next quarter</h2>
<ol type="1">
<li><strong>Budget Scenario Copilot</strong> – upload Pakistan’s FY 2025-26 budget, ask “How would a 200 bp rate hike alter debt-service ratios?”</li>
<li><strong>Telecom-sector Demand Forecaster</strong> – feed Zong’s subscriber micro-data + macro indicators into a Chronos-style LLM forecaster.</li>
<li><strong>Trade-Policy Brief Generator</strong> – scrape WTO notifications + HS-level data, auto-generate impact memos for proposed tariff changes.</li>
<li><strong>Workshop Companion Bot</strong> – participants query “GDP impact of x% digital-services tax”, get instant annotated answer plus further-reading links.</li>
</ol>
</section>
<section id="democratization-of-economic-analysis" class="level2">
<h2 class="anchored" data-anchor-id="democratization-of-economic-analysis">9. Democratization of Economic Analysis</h2>
<p>AI economic consultants are transforming who can access sophisticated economic insights:</p>
<ul>
<li><strong>Smaller businesses and developing economies</strong> gain access to analysis previously available only to large corporations and wealthy nations</li>
<li><strong>Local governments and NGOs</strong> can now leverage sophisticated economic modeling without dedicated economic teams</li>
<li><strong>Educational institutions</strong> use AI economic consultants as teaching tools, preparing students for hybrid human-AI economic analysis</li>
<li><strong>Citizen access</strong> to economic insights increases civic participation in economic policy discussions</li>
</ul>
</section>
<section id="hybrid-decision-making-models" class="level2">
<h2 class="anchored" data-anchor-id="hybrid-decision-making-models">10. Hybrid Decision-Making Models</h2>
<p>Successful implementation requires specific hybrid decision frameworks:</p>
<ul>
<li>AI systems provide initial quantitative analysis and multiple scenario projections</li>
<li>Human economists focus on contextual factors, political feasibility, and ethical considerations</li>
<li>Clear organizational protocols determine when AI recommendations:
<ul>
<li>Can be implemented directly (low-risk, routine)</li>
<li>Require light human review (medium complexity)</li>
<li>Demand thorough human scrutiny (high-stakes, novel situations)</li>
</ul></li>
<li>Feedback loops capture human adjustments to improve future AI recommendations</li>
</ul>
</section>
<section id="expanded-technical-integration-points" class="level2">
<h2 class="anchored" data-anchor-id="expanded-technical-integration-points">11. Expanded Technical Integration Points</h2>
<p>Modern AI economic consultants integrate with:</p>
<ul>
<li><strong>Real-time market data feeds</strong> enabling dynamic response to market shifts</li>
<li><strong>Central bank policy announcements</strong> with instant analysis of potential impacts</li>
<li><strong>Geopolitical risk assessment tools</strong> incorporating non-economic factors into economic models</li>
<li><strong>Blockchain/DeFi analytics</strong> for monitoring emerging financial systems and crypto markets</li>
<li><strong>Social sentiment analysis</strong> to incorporate public reaction into economic projections</li>
</ul>
</section>
<section id="ethics-and-responsibility-framework" class="level2">
<h2 class="anchored" data-anchor-id="ethics-and-responsibility-framework">12. Ethics and Responsibility Framework</h2>
<p>Economic AI requires a robust ethics framework:</p>
<ul>
<li><strong>Transparency requirements</strong> - clear documentation of data sources, assumptions, and methodological choices</li>
<li><strong>Attribution standards</strong> - explicit disclosure of when content is AI-generated versus human-reviewed</li>
<li><strong>Conflict management</strong> - protocols for handling conflicting economic interests and stakeholder priorities</li>
<li><strong>Bias mitigation</strong> - systematic processes to identify and address biases in economic data and recommendations</li>
<li><strong>Accountability mechanisms</strong> - clear responsibility chains for AI-informed economic decisions</li>
</ul>
</section>
<section id="continuous-learning-systems" class="level2">
<h2 class="anchored" data-anchor-id="continuous-learning-systems">13. Continuous Learning Systems</h2>
<p>AI economic consultants improve through:</p>
<ul>
<li><strong>Feedback integration</strong> - systematic capture of expert corrections to refine future recommendations</li>
<li><strong>Theory incorporation</strong> - mechanisms to update models with new economic research and theories</li>
<li><strong>Model drift monitoring</strong> - continuous assessment of prediction accuracy as economic conditions evolve</li>
<li><strong>Retraining triggers</strong> - automatic flags when structural economic shifts necessitate model retraining</li>
<li><strong>Cross-validation</strong> - comparing AI economic predictions against multiple baselines and human expert forecasts</li>
</ul>
</section>
<section id="bottom-line" class="level2">
<h2 class="anchored" data-anchor-id="bottom-line">Bottom line</h2>
<p>Treating AI as an economic consultant is no longer sci-fi: it’s a structured, governable workflow that can slash turnaround times and democratize access to sophisticated economic analysis—provided you keep humans firmly in the supervisory seat and develop appropriate ethical frameworks, integration points, and continuous improvement systems.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>